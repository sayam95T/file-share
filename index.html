<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Free File Share</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
    }
    h1 { margin-bottom: 10px; }
    .upload-box {
      border: 3px dashed #fff;
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      width: 400px;
      background: rgba(255,255,255,0.1);
      transition: background 0.3s;
    }
    .upload-box.dragover { background: rgba(255,255,255,0.2); }
    .progress { margin-top: 15px; width: 100%; height: 10px; border-radius: 5px; background: rgba(255,255,255,0.3); }
    .progress-bar { height: 10px; border-radius: 5px; width: 0%; background: limegreen; }
    #linkBox { margin-top: 20px; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; display: none; }
    button { margin-top: 10px; padding: 8px 15px; border: none; border-radius: 8px; cursor: pointer; background: limegreen; color: black; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ðŸš€ My Free File Share</h1>
  <p>Upload a file (expires after 24h, lossless)</p>

  <div class="upload-box" id="uploadBox">Drag & Drop or Click to Upload</div>
  <input type="file" id="fileInput" hidden />

  <div class="progress"><div class="progress-bar" id="progressBar"></div></div>

  <div id="linkBox">
    <p><b>Shareable Link:</b></p>
    <input type="text" id="downloadLink" readonly style="width:100%;padding:5px;" />
    <button onclick="copyLink()">Copy Link</button>
  </div>

  <script>
    const uploadBox = document.getElementById("uploadBox");
    const fileInput = document.getElementById("fileInput");
    const progressBar = document.getElementById("progressBar");
    const linkBox = document.getElementById("linkBox");
    const downloadLink = document.getElementById("downloadLink");

    const BACKEND_URL = "/api/upload"; // relative path, works on Vercel

    uploadBox.addEventListener("click", () => fileInput.click());

    uploadBox.addEventListener("dragover", e => {
      e.preventDefault();
      uploadBox.classList.add("dragover");
    });

    uploadBox.addEventListener("dragleave", () => uploadBox.classList.remove("dragover"));

    uploadBox.addEventListener("drop", e => {
      e.preventDefault();
      uploadBox.classList.remove("dragover");
      handleFile(e.dataTransfer.files[0]);
    });

    fileInput.addEventListener("change", e => handleFile(e.target.files[0]));

    function handleFile(file) {
      if (!file) return;
      uploadFile(file);
    }

    async function uploadFile(file) {
      let formData = new FormData();
      formData.append("file", file);

      progressBar.style.width = "0%";
      linkBox.style.display = "none";

      const xhr = new XMLHttpRequest();
      xhr.open("POST", BACKEND_URL, true);

      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) {
          let percent = (e.loaded / e.total) * 100;
          progressBar.style.width = percent + "%";
        }
      };

      xhr.onload = () => {
        if (xhr.status === 200) {
          let data = JSON.parse(xhr.responseText);
          if (data.success) {
            downloadLink.value = data.link;
            linkBox.style.display = "block";
          } else {
            alert("Upload failed: " + JSON.stringify(data));
          }
        } else {
          alert("Server error: " + xhr.status);
        }
      };

      xhr.send(formData);
    }

    function copyLink() {
      downloadLink.select();
      document.execCommand("copy");
      alert("Copied!");
    }
  </script>
</body>
</html>
